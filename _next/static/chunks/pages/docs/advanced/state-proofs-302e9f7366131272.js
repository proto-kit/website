(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9668],{2226:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/advanced/state-proofs",function(){return r(1768)}])},1768:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return K},useTOC:function(){return useTOC}});var s,a,i,l=r(2676),o=r(4331),d=r(4080),c=r(9021),u=r(2924),h=r(6544),p=r(5271),f=r(5512),x=r(1061),b=r(6978),g=r(2191),k=r(301),m=r(8349),E=r(7114);function focus_sentinel_b({onFocus:e}){let n;let[r,s]=(0,p.useState)(!0),a=(n=(0,p.useRef)(!1),(0,b.e)(()=>(n.current=!0,()=>{n.current=!1}),[]),n);return r?p.createElement(E._,{as:"button",type:"button",features:E.x.Focusable,onFocus:n=>{n.preventDefault();let r,i=50;r=requestAnimationFrame(function t(){if(i--<=0){r&&cancelAnimationFrame(r);return}if(e()){if(cancelAnimationFrame(r),!a.current)return;s(!1);return}r=requestAnimationFrame(t)})}}):null}var y=r(7194),v=r(7577),j=r(614),T=r(6904),_=r(5143);let w=p.createContext(null);function stable_collection_f({children:e}){let n=p.useRef({groups:new Map,get(e,n){var r;let s=this.groups.get(e);s||(s=new Map,this.groups.set(e,s));let a=null!=(r=s.get(n))?r:0;return s.set(n,a+1),[Array.from(s.keys()).indexOf(n),function(){let e=s.get(n);e>1?s.set(n,e-1):s.delete(n)}]}});return p.createElement(w.Provider,{value:n},e)}function C(e){let n=p.useContext(w);if(!n)throw Error("You must wrap your component in a <StableCollection>");let r=p.useId(),[s,a]=n.current.get(e,r);return p.useEffect(()=>a,[]),s}var F=r(372),I=((s=I||{})[s.Forwards=0]="Forwards",s[s.Backwards=1]="Backwards",s),P=((a=P||{})[a.Less=-1]="Less",a[a.Equal=0]="Equal",a[a.Greater=1]="Greater",a),A=((i=A||{})[i.SetSelectedIndex=0]="SetSelectedIndex",i[i.RegisterTab=1]="RegisterTab",i[i.UnregisterTab=2]="UnregisterTab",i[i.RegisterPanel=3]="RegisterPanel",i[i.UnregisterPanel=4]="UnregisterPanel",i);let O={0(e,n){var r;let s=(0,y.z2)(e.tabs,e=>e.current),a=(0,y.z2)(e.panels,e=>e.current),i=s.filter(e=>{var n;return!(null!=(n=e.current)&&n.hasAttribute("disabled"))}),l={...e,tabs:s,panels:a};if(n.index<0||n.index>s.length-1){let r=(0,v.E)(Math.sign(n.index-e.selectedIndex),{[-1]:()=>1,0:()=>(0,v.E)(Math.sign(n.index),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0});if(0===i.length)return l;let a=(0,v.E)(r,{0:()=>s.indexOf(i[0]),1:()=>s.indexOf(i[i.length-1])});return{...l,selectedIndex:-1===a?e.selectedIndex:a}}let o=s.slice(0,n.index),d=[...s.slice(n.index),...o].find(e=>i.includes(e));if(!d)return l;let c=null!=(r=s.indexOf(d))?r:e.selectedIndex;return -1===c&&(c=e.selectedIndex),{...l,selectedIndex:c}},1(e,n){if(e.tabs.includes(n.tab))return e;let r=e.tabs[e.selectedIndex],s=(0,y.z2)([...e.tabs,n.tab],e=>e.current),a=e.selectedIndex;return e.info.current.isControlled||-1===(a=s.indexOf(r))&&(a=e.selectedIndex),{...e,tabs:s,selectedIndex:a}},2:(e,n)=>({...e,tabs:e.tabs.filter(e=>e!==n.tab)}),3:(e,n)=>e.panels.includes(n.panel)?e:{...e,panels:(0,y.z2)([...e.panels,n.panel],e=>e.current)},4:(e,n)=>({...e,panels:e.panels.filter(e=>e!==n.panel)})},S=(0,p.createContext)(null);function tabs_C(e){let n=(0,p.useContext)(S);if(null===n){let n=Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,tabs_C),n}return n}S.displayName="TabsDataContext";let R=(0,p.createContext)(null);function Y(e){let n=(0,p.useContext)(R);if(null===n){let n=Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,Y),n}return n}function Fe(e,n){return(0,v.E)(n.type,O,e,n)}R.displayName="TabsActionsContext";let D=_.VN.RenderStrategy|_.VN.Static,M=(0,_.yV)(function(e,n){var r,s;let a=(0,p.useId)(),{id:i=`headlessui-tabs-tab-${a}`,disabled:l=!1,autoFocus:o=!1,...d}=e,{orientation:c,activation:g,selectedIndex:E,tabs:w,panels:I}=tabs_C("Tab"),P=Y("Tab"),A=tabs_C("Tab"),[O,S]=(0,p.useState)(null),R=(0,p.useRef)(null),D=(0,m.T)(R,n,S);(0,b.e)(()=>P.registerTab(R),[P,R]);let M=C("tabs"),N=w.indexOf(R);-1===N&&(N=M);let z=N===E,L=(0,x.z)(e=>{var n;let r=e();if(r===y.fE.Success&&"auto"===g){let e=null==(n=(0,T.r)(R))?void 0:n.activeElement,r=A.tabs.findIndex(n=>n.current===e);-1!==r&&P.change(r)}return r}),B=(0,x.z)(e=>{let n=w.map(e=>e.current).filter(Boolean);if(e.key===F.R.Space||e.key===F.R.Enter){e.preventDefault(),e.stopPropagation(),P.change(N);return}switch(e.key){case F.R.Home:case F.R.PageUp:return e.preventDefault(),e.stopPropagation(),L(()=>(0,y.jA)(n,y.TO.First));case F.R.End:case F.R.PageDown:return e.preventDefault(),e.stopPropagation(),L(()=>(0,y.jA)(n,y.TO.Last))}if(L(()=>(0,v.E)(c,{vertical:()=>e.key===F.R.ArrowUp?(0,y.jA)(n,y.TO.Previous|y.TO.WrapAround):e.key===F.R.ArrowDown?(0,y.jA)(n,y.TO.Next|y.TO.WrapAround):y.fE.Error,horizontal:()=>e.key===F.R.ArrowLeft?(0,y.jA)(n,y.TO.Previous|y.TO.WrapAround):e.key===F.R.ArrowRight?(0,y.jA)(n,y.TO.Next|y.TO.WrapAround):y.fE.Error}))===y.fE.Success)return e.preventDefault()}),q=(0,p.useRef)(!1),V=(0,x.z)(()=>{var e;q.current||(q.current=!0,null==(e=R.current)||e.focus({preventScroll:!0}),P.change(N),(0,j.Y)(()=>{q.current=!1}))}),U=(0,x.z)(e=>{e.preventDefault()}),{isFocusVisible:G,focusProps:K}=(0,u.F)({autoFocus:o}),{isHovered:W,hoverProps:$}=(0,h.X)({isDisabled:l}),{pressed:H,pressProps:X}=(0,f.x)({disabled:l}),Z=(0,p.useMemo)(()=>({selected:z,hover:W,active:H,focus:G,autofocus:o,disabled:l}),[z,W,G,H,o,l]),J=(0,_.dG)({ref:D,onKeyDown:B,onMouseDown:U,onClick:V,id:i,role:"tab",type:(0,k.f)(e,O),"aria-controls":null==(s=null==(r=I[N])?void 0:r.current)?void 0:s.id,"aria-selected":z,tabIndex:z?0:-1,disabled:l||void 0,autoFocus:o},K,$,X);return(0,_.L6)()({ourProps:J,theirProps:d,slot:Z,defaultTag:"button",name:"Tabs.Tab"})}),N=(0,_.yV)(function(e,n){let{defaultIndex:r=0,vertical:s=!1,manual:a=!1,onChange:i,selectedIndex:l=null,...o}=e,d=s?"vertical":"horizontal",c=a?"manual":"auto",u=null!==l,h=(0,g.E)({isControlled:u}),f=(0,m.T)(n),[k,E]=(0,p.useReducer)(Fe,{info:h,selectedIndex:null!=l?l:r,tabs:[],panels:[]}),v=(0,p.useMemo)(()=>({selectedIndex:k.selectedIndex}),[k.selectedIndex]),j=(0,g.E)(i||(()=>{})),T=(0,g.E)(k.tabs),w=(0,p.useMemo)(()=>({orientation:d,activation:c,...k}),[d,c,k]),F=(0,x.z)(e=>(E({type:1,tab:e}),()=>E({type:2,tab:e}))),I=(0,x.z)(e=>(E({type:3,panel:e}),()=>E({type:4,panel:e}))),P=(0,x.z)(e=>{A.current!==e&&j.current(e),u||E({type:0,index:e})}),A=(0,g.E)(u?e.selectedIndex:k.selectedIndex),O=(0,p.useMemo)(()=>({registerTab:F,registerPanel:I,change:P}),[]);(0,b.e)(()=>{E({type:0,index:null!=l?l:r})},[l]),(0,b.e)(()=>{if(void 0===A.current||k.tabs.length<=0)return;let e=(0,y.z2)(k.tabs,e=>e.current);e.some((e,n)=>k.tabs[n]!==e)&&P(e.indexOf(k.tabs[A.current]))});let D=(0,_.L6)();return p.createElement(stable_collection_f,null,p.createElement(R.Provider,{value:O},p.createElement(S.Provider,{value:w},w.tabs.length<=0&&p.createElement(focus_sentinel_b,{onFocus:()=>{var e,n;for(let r of T.current)if((null==(e=r.current)?void 0:e.tabIndex)===0)return null==(n=r.current)||n.focus(),!0;return!1}}),D({ourProps:{ref:f},theirProps:o,slot:v,defaultTag:"div",name:"Tabs"}))))}),z=(0,_.yV)(function(e,n){let{orientation:r,selectedIndex:s}=tabs_C("Tab.List"),a=(0,m.T)(n),i=(0,p.useMemo)(()=>({selectedIndex:s}),[s]);return(0,_.L6)()({ourProps:{ref:a,role:"tablist","aria-orientation":r},theirProps:e,slot:i,defaultTag:"div",name:"Tabs.List"})}),L=(0,_.yV)(function(e,n){let{selectedIndex:r}=tabs_C("Tab.Panels"),s=(0,m.T)(n),a=(0,p.useMemo)(()=>({selectedIndex:r}),[r]);return(0,_.L6)()({ourProps:{ref:s},theirProps:e,slot:a,defaultTag:"div",name:"Tabs.Panels"})}),B=(0,_.yV)(function(e,n){var r,s,a,i;let l=(0,p.useId)(),{id:o=`headlessui-tabs-panel-${l}`,tabIndex:d=0,...c}=e,{selectedIndex:h,tabs:f,panels:x}=tabs_C("Tab.Panel"),g=Y("Tab.Panel"),k=(0,p.useRef)(null),y=(0,m.T)(k,n);(0,b.e)(()=>g.registerPanel(k),[g,k]);let v=C("panels"),j=x.indexOf(k);-1===j&&(j=v);let T=j===h,{isFocusVisible:w,focusProps:F}=(0,u.F)(),I=(0,p.useMemo)(()=>({selected:T,focus:w}),[T,w]),P=(0,_.dG)({ref:y,id:o,role:"tabpanel","aria-labelledby":null==(s=null==(r=f[j])?void 0:r.current)?void 0:s.id,tabIndex:T?d:-1},F),A=(0,_.L6)();return T||null!=(a=c.unmount)&&!a||null!=(i=c.static)&&i?A({ourProps:P,theirProps:c,slot:I,defaultTag:"div",features:D,visible:T,name:"Tabs.Panel"}):p.createElement(E._,{"aria-hidden":"true",...P})}),q=Object.assign(M,{Group:N,List:z,Panels:L,Panel:B});var V=r(4814);function isTabObjectItem(e){return!!e&&"object"==typeof e&&"label"in e}let Tabs=({items:e,children:n,storageKey:r,defaultIndex:s=0,selectedIndex:a,onChange:i,className:o,tabClassName:d})=>{let[c,u]=(0,p.useState)(s);(0,p.useEffect)(()=>{void 0!==a&&u(a)},[a]),(0,p.useEffect)(()=>{if(!r)return;function fn(e){e.key===r&&u(Number(e.newValue))}let e=Number(localStorage.getItem(r));return u(Number.isNaN(e)?0:e),window.addEventListener("storage",fn),()=>{window.removeEventListener("storage",fn)}},[]);let h=(0,p.useCallback)(e=>{if(r){let n=String(e);localStorage.setItem(r,n),window.dispatchEvent(new StorageEvent("storage",{key:r,newValue:n}));return}u(e),i?.(e)},[]);return(0,l.jsxs)(N,{selectedIndex:c,defaultIndex:s,onChange:h,tabIndex:-1,children:[(0,l.jsx)(z,{className:e=>(0,V.Z)("nextra-scrollbar _overflow-x-auto _overscroll-x-contain _overflow-y-hidden","_mt-4 _flex _w-full _gap-2 _border-b _border-gray-200 _pb-px dark:_border-neutral-800","nextra-focus","function"==typeof o?o(e):o),children:e.map((e,n)=>(0,l.jsx)(q,{disabled:isTabObjectItem(e)&&e.disabled,className:e=>{let{selected:n,disabled:r,hover:s,focus:a}=e;return(0,V.Z)(a&&"nextra-focusable _ring-inset",n&&"_outline-none","_whitespace-nowrap","_rounded-t _p-2 _font-medium _leading-5 _transition-colors","_-mb-0.5 _select-none _border-b-2",n?"_border-current":s?"_border-gray-200 dark:_border-neutral-800":"_border-transparent",n?"_text-primary-600":r?"_text-gray-400 dark:_text-neutral-600 _pointer-events-none":s?"_text-black dark:_text-white":"_text-gray-600 dark:_text-gray-200","function"==typeof d?d(e):d)},children:isTabObjectItem(e)?e.label:e},n))}),(0,l.jsx)(L,{children:n})]})},U=Object.assign(e=>(0,l.jsx)(Tabs,{...e}),{Tab:({children:e,unmount:n=!1,className:r,...s})=>(0,l.jsx)(B,{...s,unmount:n,className:e=>(0,V.Z)("_rounded _mt-6",e.focus&&"nextra-focusable","function"==typeof r?r(e):r),children:e})});var G=r(3030);function useTOC(e){return[{value:"Prerequisites",id:"prerequisites",depth:2},{value:"Fetching the Data",id:"fetching-the-data",depth:3},{value:"Fetching the witness",id:"fetching-the-witness",depth:3},{value:"Creating the state proof",id:"creating-the-state-proof",depth:3}]}function _missingMdxReference(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}var K=(0,o.c)(function(e){let{toc:n=useTOC(e)}=e,r={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...(0,c.a)(),...e.components};return U||_missingMdxReference("Tabs",!1),U.Tab||_missingMdxReference("Tabs.Tab",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.h1,{children:"Using State Proofs"}),"\n",(0,l.jsx)(r.p,{children:"For some application, it is importants to be able to create a off-chain proof of some state in the protokit state-tree.\nFor example, for privacy-enabled application you want to prove that some data is in the tree,\nbut donâ€™t want to reveal under which key this data is stored."}),"\n",(0,l.jsx)(r.p,{children:"You could then attach a nullifier to that proof to prevent double-use."}),"\n",(0,l.jsx)(r.h2,{id:n[0].id,children:n[0].value}),"\n",(0,l.jsx)(r.p,{children:"In order to create a state-proof, you need two things:"}),"\n",(0,l.jsxs)(r.ol,{children:["\n",(0,l.jsx)(r.li,{children:"The data"}),"\n",(0,l.jsx)(r.li,{children:"A witness to that data"}),"\n"]}),"\n",(0,l.jsx)(r.h3,{id:n[1].id,children:n[1].value}),"\n",(0,l.jsx)(r.p,{children:"The data is very simple, you either already have it in your UI or you can fetch it via the query API"}),"\n",(0,l.jsx)(U,{items:["TS"],children:(0,l.jsx)(U.Tab,{children:(0,l.jsx)(r.pre,{icon:G.KP,tabIndex:"0","data-language":"ts","data-word-wrap":"","data-filename":"Client SDK","data-copy":"",children:(0,l.jsx)(r.code,{children:(0,l.jsxs)(r.span,{children:[(0,l.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"const"}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" state"}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:" ="}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:" await"}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" appchain.query.runtime.testModule.userState."}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"get"}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(address);"})]})})})})}),"\n",(0,l.jsx)(r.h3,{id:n[2].id,children:n[2].value}),"\n",(0,l.jsx)(r.p,{children:"After we have the data, we need to prove the relationship between that data and the state-root of the last protokit proof.\nWe do this by fetch the merkle witness and recalculating the state root inside a client-side proof."}),"\n",(0,l.jsx)(U,{items:["TS"],children:(0,l.jsx)(U.Tab,{children:(0,l.jsx)(r.pre,{icon:G.KP,tabIndex:"0","data-language":"ts","data-word-wrap":"","data-filename":"Client SDK","data-copy":"",children:(0,l.jsx)(r.code,{children:(0,l.jsxs)(r.span,{children:[(0,l.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"const"}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" witness"}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:" ="}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:" await"}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" appchain.query.runtime.testModule.userState."}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"witness"}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(address);"})]})})})})}),"\n",(0,l.jsx)(r.h3,{id:n[3].id,children:n[3].value}),"\n",(0,l.jsx)(r.p,{children:"For the state-proof we can then use the data and the witness to recalculate the root hash, which we attach to the publicOutput of our proof.\nInside the protokit runtime, we can then assert that the state-proofs root hash equals to the last state root of the protokit runtime."}),"\n",(0,l.jsx)(r.pre,{icon:G.KP,tabIndex:"0","data-language":"ts","data-word-wrap":"",children:(0,l.jsxs)(r.code,{children:[(0,l.jsxs)(r.span,{children:[(0,l.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"const"}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" rootHash"}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:" ="}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" witness."}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"computeRoot"}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"("})]}),"\n",(0,l.jsxs)(r.span,{children:[(0,l.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"    Poseidon."}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"hash"}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(state."}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"toFields"}),(0,l.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"())"})]}),"\n",(0,l.jsx)(r.span,{children:(0,l.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:");"})})]})})]})},"/docs/advanced/state-proofs",{filePath:"src/pages/docs/advanced/state-proofs.mdx",timestamp:1762858652e3,pageMap:d.v,frontMatter:{},title:"Using State Proofs"},"undefined"==typeof RemoteContent?useTOC:RemoteContent.useTOC)}},function(e){e.O(0,[4331,4080,9774,2888,179],function(){return e(e.s=2226)}),_N_E=e.O()}]);