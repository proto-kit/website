(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5076],{5605:function(e,i,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/provable-code",function(){return s(8491)}])},8491:function(e,i,s){"use strict";s.r(i),s.d(i,{useTOC:function(){return useTOC}});var t=s(2676),r=s(4331),n=s(4080),a=s(9021),o=s(9623),l=s(3030);function useTOC(e){return[{value:"What is o1js?",id:"what-is-o1js",depth:2},{value:"Programming patterns in circuits",id:"programming-patterns-in-circuits",depth:2},{value:"Loops",id:"loops",depth:3}]}i.default=(0,r.c)(function(e){let{toc:i=useTOC(e)}=e,s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",...(0,a.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{children:"Provable code"}),"\n",(0,t.jsx)(s.p,{children:"In order for a zk-rollup to verify the correctness of its operation, it has to be able to prove that e.g. the transaction was executed correctly.\nThis is possible thanks to the fact that all the underlying Protokit rollup code is written as zk-circuits using o1js. Therefore creating provable code, resulting in zk-proofs."}),"\n",(0,t.jsx)(s.h2,{id:i[0].id,children:i[0].value}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.a,{href:"https://docs.minaprotocol.com/zkapps/o1js",children:"o1js"})," is a library created by the team behind Mina that powers all of Protokit.\nIt is the backbone of everything we do and provides a simple abstraction over all zk-related things."]}),"\n",(0,t.jsx)(o.U,{type:"info",children:(0,t.jsxs)(s.p,{children:["You can learn more about o1js in the ",(0,t.jsx)(s.a,{href:"https://docs.minaprotocol.com/zkapps/o1js",children:"official docs"}),"."]})}),"\n",(0,t.jsx)(s.p,{children:"Since protokit and mina are both zk-native, we have to be able to “prove” all of the code that we write for our application.\nProving means turning a computation into a zk-proof. That happens over multiple steps."}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"We write our business and protocol logic using Protokit. In that process we will work with the primitives that o1js exposes to developers.\nThat means types for Integers, PublicKeys, hashing functions, Conditionals, etc."}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"We execute your code and translate it behind the scenes in something that is called a “circuit”. A circuit is arithmetic representation of your application’s code.\nThis representation has to be the same for every possible execution of your code. This is why we can’t have dynamically bounded loops and typescript if statements in our code (though there are some tricks to mitigate that)."}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"The circuit is then used to prove our execution and create a zk-proof (a.k.a. zk-SNARK).\nThis proof can then be verified by any other party using a small “verification key”, which is also generated using the circuit."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"So to summarize, Protokit uses o1js to lift all the snark-related stuff for us, so we can focus on writing good applications."}),"\n",(0,t.jsx)(s.h2,{id:i[1].id,children:i[1].value}),"\n",(0,t.jsx)(s.p,{children:"Writing provable code is relatively straightforward, but there are some things to keep in mind.\nNature of proof systems / o1js dictates that all code we execute must be static and have the exact same execution steps with every possible input.\nThis creates some caveats we have to watch out for during development, such as avoiding dynamic sized computation like dynamic loops, or “native” if statements."}),"\n",(0,t.jsx)(s.h3,{id:i[2].id,children:i[2].value}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Dynamic sized loops are not possible"}),". However, there are some exceptions and patterns we can still use.\nSpecifically, fixed bounded loops. That means that we can create loops as long as the loop always runs the exact same amount of iterations."]}),"\n",(0,t.jsx)(s.p,{children:"The first pattern can be used pretty safely:"}),"\n",(0,t.jsx)(s.pre,{icon:l.KP,tabIndex:"0","data-language":"ts","data-word-wrap":"",children:(0,t.jsxs)(s.code,{children:[(0,t.jsxs)(s.span,{children:[(0,t.jsx)(s.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"for"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"("}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"const"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" i"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:" ="}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" 0"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" ; i "}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"<"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" 5"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" ; i"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"++"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"){"})]}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"    // Provable code"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"}"})})]})}),"\n",(0,t.jsx)(s.p,{children:"One has to be a bit more careful with the second pattern though:"}),"\n",(0,t.jsx)(s.pre,{icon:l.KP,tabIndex:"0","data-language":"ts","data-word-wrap":"",children:(0,t.jsxs)(s.code,{children:[(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"// Precondition: inputs.length is constant"})}),"\n",(0,t.jsxs)(s.span,{children:[(0,t.jsx)(s.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"function"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:" foo"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"("}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"},children:"inputs"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:":"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:" Field"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"[]){"})]}),"\n",(0,t.jsxs)(s.span,{children:[(0,t.jsx)(s.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"    for"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"("}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"const"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" input"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:" of"}),(0,t.jsx)(s.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" inputs){"})]}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"        // Provable code"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"    }"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"}"})})]})}),"\n",(0,t.jsxs)(s.p,{children:["The developer has to make sure that the length of ",(0,t.jsx)(s.em,{children:"inputs"})," stays the same for every invocation.\nA failure to do so will result in something we call “compiler/prover discrepancies”, where the circuit we are trying to prove is a different one from the originally compiled one.\nThis will throw obscure errors way down the stack, so it’s better to avoid these issues alltogether."]}),"\n",(0,t.jsxs)(s.p,{children:["Logically, correct usage of this pattern also enables usage of methods like ",(0,t.jsx)(s.code,{children:"forEach"}),", ",(0,t.jsx)(s.code,{children:"map"}),", ",(0,t.jsx)(s.code,{children:"reduce"}),", etc."]})]})},"/docs/provable-code",{filePath:"src/pages/docs/provable-code.mdx",timestamp:1763043902e3,pageMap:n.v,frontMatter:{},title:"Provable code"},"undefined"==typeof RemoteContent?useTOC:RemoteContent.useTOC)},9623:function(e,i,s){"use strict";s.d(i,{U:function(){return Callout}});var t=s(2676),r=s(4814),n=s(3030);let a={default:"\uD83D\uDCA1",error:"\uD83D\uDEAB",info:(0,t.jsx)(n.AV,{className:"_mt-1"}),warning:"⚠️"},o={default:(0,r.Z)("_border-orange-100 _bg-orange-50 _text-orange-800 dark:_border-orange-400/30 dark:_bg-orange-400/20 dark:_text-orange-300"),error:(0,r.Z)("_border-red-200 _bg-red-100 _text-red-900 dark:_border-red-200/30 dark:_bg-red-900/30 dark:_text-red-200"),info:(0,r.Z)("_border-blue-200 _bg-blue-100 _text-blue-900 dark:_border-blue-200/30 dark:_bg-blue-900/30 dark:_text-blue-200"),warning:(0,r.Z)("_border-yellow-100 _bg-yellow-50 _text-yellow-900 dark:_border-yellow-200/30 dark:_bg-yellow-700/30 dark:_text-yellow-200")};function Callout({children:e,type:i="default",emoji:s=a[i]}){return(0,t.jsxs)("div",{className:(0,r.Z)("nextra-callout _overflow-x-auto _mt-6 _flex _rounded-lg _border _py-2 ltr:_pr-4 rtl:_pl-4","contrast-more:_border-current contrast-more:dark:_border-current",o[i]),children:[(0,t.jsx)("div",{className:"_select-none _text-xl ltr:_pl-3 ltr:_pr-2 rtl:_pr-3 rtl:_pl-2",style:{fontFamily:'"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"'},children:s}),(0,t.jsx)("div",{className:"_w-full _min-w-0 _leading-7",children:e})]})}}},function(e){e.O(0,[4331,4080,9774,2888,179],function(){return e(e.s=5605)}),_N_E=e.O()}]);